<!DOCTYPE HTML>
<html>
	<head>
		<title>DIEU KHIEN CUA</title>
	</head>
	<body>
		<div> Trang thai ket noi
			<span id="status" style="font-weight: bold;"> disconnected </span>
		</div>
		<div> Trang thai cua  
			<input type="checkbox" id="btn" name="btn" />
		</div>
		<div> DONG MO CUA 
			<input type="checkbox" id="door" name="door" disabled="true" />
		</div>
		<div> Che do tu dong 
			<input type="checkbox" id="auto" name="auto" />
		</div>
		<script type="text/javascript">
            var checkbox = document.getElementById('btn');
            var door = document.getElementById('door');
	    var auto = document.getElementById('auto');
            var url = window.location.host; 


            var ws = new WebSocket('wss://' + url + '/'); 
            console.log('connecting...');

            ws.onopen = function() 
            {
                document.getElementById('status').innerHTML = 'Connected';
                door.disabled = false; 
                console.log('connected...');
            };

            ws.onmessage = function(evt)
            {
                console.log(evt.data);
                if (evt.data == 'BTN_PRESSED') {
                    checkbox.checked = true;
                } else if (evt.data == 'BTN_RELEASE') {
                    checkbox.checked = false;
                } else if (evt.data == 'door_OFF') {
                    door.checked = false;
                } else if (evt.data == 'door_ON') {
                    door.checked = true;
		} else if (evt.data == 'AUTO_ON') {
                    auto.checked = true;
                } else if (evt.data == 'AUTO_OFF') {
                    auto.checked = false;
                }
            };

            ws.onclose = function() { // Hàm này sẽ được thực hiện khi đóng websocket
                door.disabled = true;
                document.getElementById('status').innerHTML = 'Disconnected';
            };

            door.onchange = function() { // Thực hiện thay đổi bật/tắt door
                var door_status = 'door_OFF';
                if (door.checked) {
                    door_status = 'door_ON';
                }
                ws.send(door_status); // Gửi trạng thái door tới server
            };

	    auto.onchange = function() { // Thực hiện thay đổi bật/tắt door
                var auto_status = 'auto_OFF';
                if (auto.checked) {
                    auto_status = 'auto_ON';
                }
                ws.send(auto_status); // Gửi trạng thái door tới server
            };
	
        </script>
	</body>
</html>
